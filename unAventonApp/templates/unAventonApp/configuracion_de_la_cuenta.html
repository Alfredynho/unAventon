{% extends "unAventonApp/base.html" %}
{% block title %}Perfil{% endblock %}

{% block content %}

<div class="container">

    <h3 onclick="mostrar('#datos')">Datos Personales</h3>
    <div id="datos" style="display: none"></div>
    <hr>
    <h3>Tarjetas</h3>
    <div id="tarjetas"></div>
    <hr>
    <h3  onclick="mostrar('#autos')">Vehiculos</h3>
    <div id="autos" style="display: none"></div>
    <hr>
    <h3>Reputacion</h3>
    <hr>
    <button onclick="changeToEditable()">editar</button>
    <button onclick="updateUserData()">guardar</button>
</div>

<script>


    $(function(){
        loadUserData();
    });

    function loadUserData(){
        var url = '{% url "datos_del_usuario" %}';
        getJson(url,{},function(data){insertData(data);},function(data){errorMessage(data);});
    }

    function insertData(data) {
        armarLista("#datos", data.usuario);
        for (var key in data.vehiculos){
           armarLista("#autos",data.vehiculos[key])
        };
        console.log()
    }

    function armarLista(id, datos){
       for(var key in datos) {
           $(id).append('<p> ' + key + ' <input id="id_'+key+'"value="' + datos[key] + '"name="'+key+'" readonly></p>')
       }
   }

    function errorMessage(data) {
       console.log(data.error)
   }

    function updateUserData() {
        var url = '{% url "actualizar_datos_usuario" %}';
        var data = {
            {% for key,value in context.items %}
            '{{ key }}': $("#id_{{ key }}").val(),
            {% endfor %}
        }
        postJson(url,data,function(result){console.log(result);},function(result){errorMessage(result);});
    }

    function mostrar(id) {
        $(id).toggle(400);
    }

    function changeToEditable(){
        $("input").removeAttr('readonly')
    }

</script>

{% endblock %}


